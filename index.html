<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <title>Dungeons & Degenerates | Fixed Port</title>
    <style>
      body { margin: 0; background: #0d0d0d; color: #ff4d4d; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; font-family: sans-serif; }
      #game-wrapper { width: 960px; height: 540px; border: 2px solid #5b3943; position: relative; background: #000; border-radius: 8px; box-shadow: 0 0 50px rgba(255, 77, 77, 0.1); }
      #canvas { width: 100%; height: 100%; display: block; }
      #status { position: absolute; inset: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; background: #000; }
      progress { width: 50%; accent-color: #ff4d4d; height: 12px; }
      button { padding: 15px 35px; background: #ff4d4d; color: white; border: none; cursor: pointer; font-weight: bold; border-radius: 5px; text-transform: uppercase; }
      button:hover { background: #fff; color: #ff4d4d; }
    </style>
    <script src="https://raw.githack.com/SnakierdoorCode/FixedDungeonsAndDegenerates/master/index.js"></script>
  </head>
  <body>
    <div id="game-wrapper">
      <canvas id="canvas"></canvas>
      <div id="status">
        <h2 id="msg">DUNGEON INITIALIZED</h2>
        <progress id="bar" value="0" max="100" style="display:none;"></progress><br>
        <button id="start-btn">START LOADING</button>
      </div>
    </div>

    <script>
      const msg = document.getElementById('msg');
      const bar = document.getElementById('bar');
      const btn = document.getElementById('start-btn');
      
      // NEW REPO BASE URL
      const BASE_RAW = "https://raw.githubusercontent.com/SnakierdoorCode/FixedDungeonsAndDegenerates/master/";
      const BASE_HACK = "https://raw.githack.com/SnakierdoorCode/FixedDungeonsAndDegenerates/master/";

      btn.onclick = async () => {
        btn.style.display = 'none';
        bar.style.display = 'block';
        console.log("üöÄ Booting from FixedDungeonsAndDegenerates...");
        
        try {
          // 1. Fetch Part 1
          msg.innerText = "LOADING PACK PART 1...";
          const r1 = await fetch(BASE_RAW + 'index.pck.001');
          const p1 = await r1.arrayBuffer();
          console.log("‚úÖ Part 1 Size: " + p1.byteLength + " bytes");

          // 2. Fetch Part 2
          msg.innerText = "LOADING PACK PART 2...";
          const r2 = await fetch(BASE_RAW + 'index.pck.002');
          const p2 = await r2.arrayBuffer();
          console.log("‚úÖ Part 2 Size: " + p2.byteLength + " bytes");

          // LFS Safety Check
          if (p1.byteLength < 1000) {
            throw new Error("LFS Detected! File size is only " + p1.byteLength + " bytes. Re-upload via browser.");
          }

          // 3. Combine
          msg.innerText = "MERGING DATA...";
          const combined = new Uint8Array(p1.byteLength + p2.byteLength);
          combined.set(new Uint8Array(p1), 0);
          combined.set(new Uint8Array(p2), p1.byteLength);
          console.log("üõ†Ô∏è Combined Size: " + combined.byteLength);

          // 4. Engine Setup
          const dummyUrl = URL.createObjectURL(new Blob([new Uint8Array([0])]));
          const engine = new Engine({
              "args": ["--main-pack", "index.pck"],
              "canvasResizePolicy": 2,
              "executable": BASE_HACK + "index",
              "fileSizes": {"index.wasm": 43699190},
              "pck": dummyUrl 
          });

          // 5. Injection
          msg.innerText = "PREPARING ENGINE...";
          await engine.preloadFile(combined.buffer, "index.pck");
          console.log("üíâ PCK Injected Successfully.");

          // 6. Start
          msg.innerText = "OPENING DUNGEON...";
          engine.startGame().then(() => {
            console.log("üéÆ Game Running!");
            document.getElementById('status').style.display = 'none';
          });

        } catch (e) {
          console.error("‚ùå ERROR:", e.message);
          msg.innerText = "ERROR: " + e.message;
        }
      };
    </script>
  </body>
</html>